["4b4934c38e12a09cc14fb0a207f18203d9faf63b","99a60aff2d4b1f9a29bd24e99964dbf0b41cb1d2",["./index.js","inherits"],[20,186],{"version":3,"sources":["/home/ziddi/Desktop/venders/node_modules/htmlparser2/lib/FeedHandler.js"],"names":["index","require","DomHandler","DomUtils","FeedHandler","callback","options","init","prototype","getElements","what","where","getElementsByTagName","getOneElement","fetch","recurse","getText","trim","addConditionally","obj","prop","tmp","isValidFeed","value","onend","feed","feedRoot","dom","childs","name","children","type","attribs","href","link","updated","Date","items","map","item","entry","description","pubDate","substr","id","_handleCallback","call","Error","module","exports"],"mappings":"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","sourcesContent":["var index = require(\"./index.js\"),\n    DomHandler = index.DomHandler,\n    DomUtils = index.DomUtils;\n\n//TODO: make this a streamable handler\nfunction FeedHandler(callback, options){\n\tthis.init(callback, options);\n}\n\nrequire(\"inherits\")(FeedHandler, DomHandler);\n\nFeedHandler.prototype.init = DomHandler;\n\nfunction getElements(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true);\n}\nfunction getOneElement(what, where){\n\treturn DomUtils.getElementsByTagName(what, where, true, 1)[0];\n}\nfunction fetch(what, where, recurse){\n\treturn DomUtils.getText(\n\t\tDomUtils.getElementsByTagName(what, where, recurse, 1)\n\t).trim();\n}\n\nfunction addConditionally(obj, prop, what, where, recurse){\n\tvar tmp = fetch(what, where, recurse);\n\tif(tmp) obj[prop] = tmp;\n}\n\nvar isValidFeed = function(value){\n\treturn value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n};\n\nFeedHandler.prototype.onend = function(){\n\tvar feed = {},\n\t    feedRoot = getOneElement(isValidFeed, this.dom),\n\t    tmp, childs;\n\n\tif(feedRoot){\n\t\tif(feedRoot.name === \"feed\"){\n\t\t\tchilds = feedRoot.children;\n\n\t\t\tfeed.type = \"atom\";\n\t\t\taddConditionally(feed, \"id\", \"id\", childs);\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\tif((tmp = getOneElement(\"link\", childs)) && (tmp = tmp.attribs) && (tmp = tmp.href)) feed.link = tmp;\n\t\t\taddConditionally(feed, \"description\", \"subtitle\", childs);\n\t\t\tif((tmp = fetch(\"updated\", childs))) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"email\", childs, true);\n\n\t\t\tfeed.items = getElements(\"entry\", childs).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"id\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\tif((tmp = getOneElement(\"link\", item)) && (tmp = tmp.attribs) && (tmp = tmp.href)) entry.link = tmp;\n\t\t\t\tif((tmp = fetch(\"summary\", item) || fetch(\"content\", item))) entry.description = tmp;\n\t\t\t\tif((tmp = fetch(\"updated\", item))) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t} else {\n\t\t\tchilds = getOneElement(\"channel\", feedRoot.children).children;\n\n\t\t\tfeed.type = feedRoot.name.substr(0, 3);\n\t\t\tfeed.id = \"\";\n\t\t\taddConditionally(feed, \"title\", \"title\", childs);\n\t\t\taddConditionally(feed, \"link\", \"link\", childs);\n\t\t\taddConditionally(feed, \"description\", \"description\", childs);\n\t\t\tif((tmp = fetch(\"lastBuildDate\", childs))) feed.updated = new Date(tmp);\n\t\t\taddConditionally(feed, \"author\", \"managingEditor\", childs, true);\n\n\t\t\tfeed.items = getElements(\"item\", feedRoot.children).map(function(item){\n\t\t\t\tvar entry = {}, tmp;\n\n\t\t\t\titem = item.children;\n\n\t\t\t\taddConditionally(entry, \"id\", \"guid\", item);\n\t\t\t\taddConditionally(entry, \"title\", \"title\", item);\n\t\t\t\taddConditionally(entry, \"link\", \"link\", item);\n\t\t\t\taddConditionally(entry, \"description\", \"description\", item);\n\t\t\t\tif((tmp = fetch(\"pubDate\", item))) entry.pubDate = new Date(tmp);\n\t\t\t\treturn entry;\n\t\t\t});\n\t\t}\n\t}\n\tthis.dom = feed;\n\tDomHandler.prototype._handleCallback.call(\n\t\tthis, feedRoot ? null : Error(\"couldn't find root of feed\")\n\t);\n};\n\nmodule.exports = FeedHandler;\n"]}]