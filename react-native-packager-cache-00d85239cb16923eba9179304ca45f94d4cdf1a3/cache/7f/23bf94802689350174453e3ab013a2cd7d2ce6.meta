["cdee12ab4dc3a041461100433f689d8847198334","50c724f23922c8dfc18bbffac3ef21b46f626154",["./constants","./defaults/asyncLocalStorage","./purgeStoredState","json-stringify-safe"],[103,153,290,416],{"version":3,"sources":["/home/ziddi/Desktop/venders/node_modules/redux-persist/lib/createPersistor.js"],"names":["exports","__esModule","default","createPersistor","_constants","require","_asyncLocalStorage","_asyncLocalStorage2","_interopRequireDefault","_purgeStoredState","_purgeStoredState2","_jsonStringifySafe","_jsonStringifySafe2","obj","store","config","serializer","serialize","data","defaultSerializer","deserializer","defaultDeserializer","blacklist","whitelist","transforms","debounce","keyPrefix","undefined","KEY_PREFIX","stateInit","_stateInit","stateIterator","_stateIterator","defaultStateIterator","stateGetter","_stateGetter","defaultStateGetter","stateSetter","_stateSetter","defaultStateSetter","storage","keys","getAllKeys","lastState","paused","storesToProcess","timeIterator","subscribe","state","getState","subState","key","passWhitelistBlacklist","indexOf","push","len","length","setInterval","clearInterval","shift","storageKey","createStorageKey","endState","reduce","transformer","in","setItem","warnIfSetError","adhocRehydrate","incoming","options","arguments","serial","value","reduceRight","interState","out","err","process","env","NODE_ENV","console","warn","dispatch","rehydrateAction","rehydrate","pause","resume","purge","setError","k","v","Error","JSON","parse","type","REHYDRATE","payload","collection","callback","Object","forEach"],"mappings":"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","sourcesContent":["'use strict';\n\nexports.__esModule = true;\nexports.default = createPersistor;\n\nvar _constants = require('./constants');\n\nvar _asyncLocalStorage = require('./defaults/asyncLocalStorage');\n\nvar _asyncLocalStorage2 = _interopRequireDefault(_asyncLocalStorage);\n\nvar _purgeStoredState = require('./purgeStoredState');\n\nvar _purgeStoredState2 = _interopRequireDefault(_purgeStoredState);\n\nvar _jsonStringifySafe = require('json-stringify-safe');\n\nvar _jsonStringifySafe2 = _interopRequireDefault(_jsonStringifySafe);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction createPersistor(store, config) {\n  // defaults\n  var serializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultSerializer;\n  var deserializer = config.serialize === false ? function (data) {\n    return data;\n  } : defaultDeserializer;\n  var blacklist = config.blacklist || [];\n  var whitelist = config.whitelist || false;\n  var transforms = config.transforms || [];\n  var debounce = config.debounce || false;\n  var keyPrefix = config.keyPrefix !== undefined ? config.keyPrefix : _constants.KEY_PREFIX;\n\n  // pluggable state shape (e.g. immutablejs)\n  var stateInit = config._stateInit || {};\n  var stateIterator = config._stateIterator || defaultStateIterator;\n  var stateGetter = config._stateGetter || defaultStateGetter;\n  var stateSetter = config._stateSetter || defaultStateSetter;\n\n  // storage with keys -> getAllKeys for localForage support\n  var storage = config.storage || (0, _asyncLocalStorage2.default)('local');\n  if (storage.keys && !storage.getAllKeys) {\n    storage.getAllKeys = storage.keys;\n  }\n\n  // initialize stateful values\n  var lastState = stateInit;\n  var paused = false;\n  var storesToProcess = [];\n  var timeIterator = null;\n\n  store.subscribe(function () {\n    if (paused) return;\n\n    var state = store.getState();\n\n    stateIterator(state, function (subState, key) {\n      if (!passWhitelistBlacklist(key)) return;\n      if (stateGetter(lastState, key) === stateGetter(state, key)) return;\n      if (storesToProcess.indexOf(key) !== -1) return;\n      storesToProcess.push(key);\n    });\n\n    var len = storesToProcess.length;\n\n    // time iterator (read: debounce)\n    if (timeIterator === null) {\n      timeIterator = setInterval(function () {\n        if (paused && len === storesToProcess.length || storesToProcess.length === 0) {\n          clearInterval(timeIterator);\n          timeIterator = null;\n          return;\n        }\n\n        var key = storesToProcess.shift();\n        var storageKey = createStorageKey(key);\n        var endState = transforms.reduce(function (subState, transformer) {\n          return transformer.in(subState, key);\n        }, stateGetter(store.getState(), key));\n        if (typeof endState !== 'undefined') storage.setItem(storageKey, serializer(endState), warnIfSetError(key));\n      }, debounce);\n    }\n\n    lastState = state;\n  });\n\n  function passWhitelistBlacklist(key) {\n    if (whitelist && whitelist.indexOf(key) === -1) return false;\n    if (blacklist.indexOf(key) !== -1) return false;\n    return true;\n  }\n\n  function adhocRehydrate(incoming) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var state = {};\n    if (options.serial) {\n      stateIterator(incoming, function (subState, key) {\n        try {\n          var data = deserializer(subState);\n          var value = transforms.reduceRight(function (interState, transformer) {\n            return transformer.out(interState, key);\n          }, data);\n          state = stateSetter(state, key, value);\n        } catch (err) {\n          if (process.env.NODE_ENV !== 'production') console.warn('Error rehydrating data for key \"' + key + '\"', subState, err);\n        }\n      });\n    } else state = incoming;\n\n    store.dispatch(rehydrateAction(state));\n    return state;\n  }\n\n  function createStorageKey(key) {\n    return '' + keyPrefix + key;\n  }\n\n  // return `persistor`\n  return {\n    rehydrate: adhocRehydrate,\n    pause: function pause() {\n      paused = true;\n    },\n    resume: function resume() {\n      paused = false;\n    },\n    purge: function purge(keys) {\n      return (0, _purgeStoredState2.default)({ storage: storage, keyPrefix: keyPrefix }, keys);\n    }\n  };\n}\n\nfunction warnIfSetError(key) {\n  return function setError(err) {\n    if (err && process.env.NODE_ENV !== 'production') {\n      console.warn('Error storing data for key:', key, err);\n    }\n  };\n}\n\nfunction defaultSerializer(data) {\n  return (0, _jsonStringifySafe2.default)(data, null, null, function (k, v) {\n    if (process.env.NODE_ENV !== 'production') return null;\n    throw new Error('\\n      redux-persist: cannot process cyclical state.\\n      Consider changing your state structure to have no cycles.\\n      Alternatively blacklist the corresponding reducer key.\\n      Cycle encounted at key \"' + k + '\" with value \"' + v + '\".\\n    ');\n  });\n}\n\nfunction defaultDeserializer(serial) {\n  return JSON.parse(serial);\n}\n\nfunction rehydrateAction(data) {\n  return {\n    type: _constants.REHYDRATE,\n    payload: data\n  };\n}\n\nfunction defaultStateIterator(collection, callback) {\n  return Object.keys(collection).forEach(function (key) {\n    return callback(collection[key], key);\n  });\n}\n\nfunction defaultStateGetter(state, key) {\n  return state[key];\n}\n\nfunction defaultStateSetter(state, key, value) {\n  state[key] = value;\n  return state;\n}"]}]