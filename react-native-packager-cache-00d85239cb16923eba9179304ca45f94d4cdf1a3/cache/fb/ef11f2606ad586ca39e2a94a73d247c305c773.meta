["2b951956307b59d607ddf3a9e04c17e5551468d9","c1361ccd4a949daac3132ea4d3d3fd56c6908758",["domelementtype","./lib/node","./lib/element"],[26,102,148],{"version":3,"sources":["/home/ziddi/Desktop/venders/node_modules/domhandler/index.js"],"names":["ElementType","require","re_whitespace","NodePrototype","ElementPrototype","DomHandler","callback","options","elementCB","defaultOpts","_callback","_options","_elementCB","dom","_done","_tagStack","_parser","normalizeWhitespace","withStartIndices","withEndIndices","prototype","onparserinit","parser","onreset","call","onend","_handleCallback","onerror","error","onclosetag","elem","pop","endIndex","_createDomElement","properties","withDomLvl1","element","type","Object","create","key","hasOwnProperty","_addDomElement","parent","length","siblings","children","previousSibling","next","startIndex","prev","push","onopentag","name","attribs","Script","Style","Tag","ontext","data","normalize","ignoreWhitespace","lastTag","Text","replace","oncomment","Comment","oncdatastart","CDATA","oncommentend","oncdataend","onprocessinginstruction","Directive","module","exports"],"mappings":"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","sourcesContent":["var ElementType = require(\"domelementtype\");\n\nvar re_whitespace = /\\s+/g;\nvar NodePrototype = require(\"./lib/node\");\nvar ElementPrototype = require(\"./lib/element\");\n\nfunction DomHandler(callback, options, elementCB){\n\tif(typeof callback === \"object\"){\n\t\telementCB = options;\n\t\toptions = callback;\n\t\tcallback = null;\n\t} else if(typeof options === \"function\"){\n\t\telementCB = options;\n\t\toptions = defaultOpts;\n\t}\n\tthis._callback = callback;\n\tthis._options = options || defaultOpts;\n\tthis._elementCB = elementCB;\n\tthis.dom = [];\n\tthis._done = false;\n\tthis._tagStack = [];\n\tthis._parser = this._parser || null;\n}\n\n//default options\nvar defaultOpts = {\n\tnormalizeWhitespace: false, //Replace all whitespace with single spaces\n\twithStartIndices: false, //Add startIndex properties to nodes\n\twithEndIndices: false, //Add endIndex properties to nodes\n};\n\nDomHandler.prototype.onparserinit = function(parser){\n\tthis._parser = parser;\n};\n\n//Resets the handler back to starting state\nDomHandler.prototype.onreset = function(){\n\tDomHandler.call(this, this._callback, this._options, this._elementCB);\n};\n\n//Signals the handler that parsing is done\nDomHandler.prototype.onend = function(){\n\tif(this._done) return;\n\tthis._done = true;\n\tthis._parser = null;\n\tthis._handleCallback(null);\n};\n\nDomHandler.prototype._handleCallback =\nDomHandler.prototype.onerror = function(error){\n\tif(typeof this._callback === \"function\"){\n\t\tthis._callback(error, this.dom);\n\t} else {\n\t\tif(error) throw error;\n\t}\n};\n\nDomHandler.prototype.onclosetag = function(){\n\t//if(this._tagStack.pop().name !== name) this._handleCallback(Error(\"Tagname didn't match!\"));\n\t\n\tvar elem = this._tagStack.pop();\n\n\tif(this._options.withEndIndices){\n\t\telem.endIndex = this._parser.endIndex;\n\t}\n\n\tif(this._elementCB) this._elementCB(elem);\n};\n\nDomHandler.prototype._createDomElement = function(properties){\n\tif (!this._options.withDomLvl1) return properties;\n\n\tvar element;\n\tif (properties.type === \"tag\") {\n\t\telement = Object.create(ElementPrototype);\n\t} else {\n\t\telement = Object.create(NodePrototype);\n\t}\n\n\tfor (var key in properties) {\n\t\tif (properties.hasOwnProperty(key)) {\n\t\t\telement[key] = properties[key];\n\t\t}\n\t}\n\n\treturn element;\n};\n\nDomHandler.prototype._addDomElement = function(element){\n\tvar parent = this._tagStack[this._tagStack.length - 1];\n\tvar siblings = parent ? parent.children : this.dom;\n\tvar previousSibling = siblings[siblings.length - 1];\n\n\telement.next = null;\n\n\tif(this._options.withStartIndices){\n\t\telement.startIndex = this._parser.startIndex;\n\t}\n\tif(this._options.withEndIndices){\n\t\telement.endIndex = this._parser.endIndex;\n\t}\n\n\tif(previousSibling){\n\t\telement.prev = previousSibling;\n\t\tpreviousSibling.next = element;\n\t} else {\n\t\telement.prev = null;\n\t}\n\n\tsiblings.push(element);\n\telement.parent = parent || null;\n};\n\nDomHandler.prototype.onopentag = function(name, attribs){\n\tvar properties = {\n\t\ttype: name === \"script\" ? ElementType.Script : name === \"style\" ? ElementType.Style : ElementType.Tag,\n\t\tname: name,\n\t\tattribs: attribs,\n\t\tchildren: []\n\t};\n\n\tvar element = this._createDomElement(properties);\n\n\tthis._addDomElement(element);\n\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.ontext = function(data){\n\t//the ignoreWhitespace is officially dropped, but for now,\n\t//it's an alias for normalizeWhitespace\n\tvar normalize = this._options.normalizeWhitespace || this._options.ignoreWhitespace;\n\n\tvar lastTag;\n\n\tif(!this._tagStack.length && this.dom.length && (lastTag = this.dom[this.dom.length-1]).type === ElementType.Text){\n\t\tif(normalize){\n\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t} else {\n\t\t\tlastTag.data += data;\n\t\t}\n\t} else {\n\t\tif(\n\t\t\tthis._tagStack.length &&\n\t\t\t(lastTag = this._tagStack[this._tagStack.length - 1]) &&\n\t\t\t(lastTag = lastTag.children[lastTag.children.length - 1]) &&\n\t\t\tlastTag.type === ElementType.Text\n\t\t){\n\t\t\tif(normalize){\n\t\t\t\tlastTag.data = (lastTag.data + data).replace(re_whitespace, \" \");\n\t\t\t} else {\n\t\t\t\tlastTag.data += data;\n\t\t\t}\n\t\t} else {\n\t\t\tif(normalize){\n\t\t\t\tdata = data.replace(re_whitespace, \" \");\n\t\t\t}\n\n\t\t\tvar element = this._createDomElement({\n\t\t\t\tdata: data,\n\t\t\t\ttype: ElementType.Text\n\t\t\t});\n\n\t\t\tthis._addDomElement(element);\n\t\t}\n\t}\n};\n\nDomHandler.prototype.oncomment = function(data){\n\tvar lastTag = this._tagStack[this._tagStack.length - 1];\n\n\tif(lastTag && lastTag.type === ElementType.Comment){\n\t\tlastTag.data += data;\n\t\treturn;\n\t}\n\n\tvar properties = {\n\t\tdata: data,\n\t\ttype: ElementType.Comment\n\t};\n\n\tvar element = this._createDomElement(properties);\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncdatastart = function(){\n\tvar properties = {\n\t\tchildren: [{\n\t\t\tdata: \"\",\n\t\t\ttype: ElementType.Text\n\t\t}],\n\t\ttype: ElementType.CDATA\n\t};\n\n\tvar element = this._createDomElement(properties);\n\n\tthis._addDomElement(element);\n\tthis._tagStack.push(element);\n};\n\nDomHandler.prototype.oncommentend = DomHandler.prototype.oncdataend = function(){\n\tthis._tagStack.pop();\n};\n\nDomHandler.prototype.onprocessinginstruction = function(name, data){\n\tvar element = this._createDomElement({\n\t\tname: name,\n\t\tdata: data,\n\t\ttype: ElementType.Directive\n\t});\n\n\tthis._addDomElement(element);\n};\n\nmodule.exports = DomHandler;\n"]}]