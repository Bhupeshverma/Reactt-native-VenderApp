["e78f2873a92ece02c982bdcb5994724ff82639e2","0dd451bca42dda84b50e02eae626858a6ac6fdfb",["./path-getter","./utils"],[25,63],{"version":3,"sources":["/home/ziddi/Desktop/venders/node_modules/jsan/lib/cycle.js"],"names":["pathGetter","require","utils","WMap","WeakMap","keys","values","set","key","value","push","get","i","length","exports","decycle","object","options","replacer","map","hasCircular","Object","prototype","hasOwnProperty","call","derez","_value","path","name","nu","date","Date","$jsan","getTime","regex","RegExp","getRegexFlags","source","stringifyFunction","isNaN","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","undefined","Error","message","symbolKey","keyFor","toString","slice","Map","Array","from","JSON","stringify","Set","toJSON","Boolean","String","foundPath","indexOf","circular","apply","nextPath","test","retrocycle","$","rez","item","restore"],"mappings":"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","sourcesContent":["var pathGetter = require('./path-getter');\nvar utils = require('./utils');\n\nvar WMap = typeof WeakMap !== 'undefined'?\n  WeakMap:\n  function() {\n    var keys = [];\n    var values = [];\n    return {\n      set: function(key, value) {\n        keys.push(key);\n        values.push(value);\n      },\n      get: function(key) {\n        for (var i = 0; i < keys.length; i++) {\n          if (keys[i] === key) {\n            return values[i];\n          }\n        }\n      }\n    }\n  };\n\n// Based on https://github.com/douglascrockford/JSON-js/blob/master/cycle.js\n\nexports.decycle = function decycle(object, options, replacer) {\n  'use strict';\n\n  var map = new WMap()\n\n  var hasCircular = Object.prototype.hasOwnProperty.call(options, 'circular');\n\n  return (function derez(_value, path, key) {\n\n    // The derez recurses through the object, producing the deep copy.\n\n    var i,        // The loop counter\n      name,       // Property name\n      nu;         // The new object or array\n\n    // typeof null === 'object', so go on if this value is really an object but not\n    // one of the weird builtin objects.\n\n    var value = replacer ? replacer(key || '', _value) : _value;\n\n    if (options.date && value instanceof Date) {\n      return {$jsan: 'd' + value.getTime()};\n    }\n    if (options.regex && value instanceof RegExp) {\n      return {$jsan: 'r' + utils.getRegexFlags(value) + ',' + value.source};\n    }\n    if (options['function'] && typeof value === 'function') {\n      return {$jsan: 'f' + utils.stringifyFunction(value, options['function'])}\n    }\n    if (options['nan'] && typeof value === 'number' && isNaN(value)) {\n      return {$jsan: 'n'}\n    }\n    if (options['infinity']) {\n      if (Number.POSITIVE_INFINITY === value) return {$jsan: 'i'}\n      if (Number.NEGATIVE_INFINITY === value) return {$jsan: 'y'}\n    }\n    if (options['undefined'] && value === undefined) {\n      return {$jsan: 'u'}\n    }\n    if (options['error'] && value instanceof Error) {\n      return {$jsan: 'e' + value.message}\n    }\n    if (options['symbol'] && typeof value === 'symbol') {\n      var symbolKey = Symbol.keyFor(value)\n      if (symbolKey !== undefined) {\n        return {$jsan: 'g' + symbolKey}\n      }\n\n      // 'Symbol(foo)'.slice(7, -1) === 'foo'\n      return {$jsan: 's' + value.toString().slice(7, -1)}\n    }\n\n    if (options['map'] && typeof Map === 'function' && value instanceof Map && typeof Array.from === 'function') {\n      return {$jsan: 'm' + JSON.stringify(decycle(Array.from(value), options, replacer))}\n    }\n\n    if (options['set'] && typeof Set === 'function' && value instanceof Set && typeof Array.from === 'function') {\n      return {$jsan: 'l' + JSON.stringify(decycle(Array.from(value), options, replacer))}\n    }\n\n    if (value && typeof value.toJSON === 'function') {\n      value = value.toJSON(key);\n    }\n\n    if (typeof value === 'object' && value !== null &&\n      !(value instanceof Boolean) &&\n      !(value instanceof Date)    &&\n      !(value instanceof Number)  &&\n      !(value instanceof RegExp)  &&\n      !(value instanceof String)  &&\n      !(typeof value === 'symbol')  &&\n      !(value instanceof Error)) {\n\n        // If the value is an object or array, look to see if we have already\n        // encountered it. If so, return a $ref/path object.\n\n      if (typeof value === 'object' && value !== null) {\n        var foundPath = map.get(value);\n        if (foundPath) {\n          if (hasCircular && path.indexOf(foundPath) === 0) {\n            return typeof options.circular === 'function'?\n              options.circular(value, path, foundPath):\n              options.circular;\n          }\n          return {$jsan: foundPath};\n        }\n        map.set(value, path);\n      }\n\n\n      // If it is an array, replicate the array.\n\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n          nu = [];\n          for (i = 0; i < value.length; i += 1) {\n              nu[i] = derez(value[i], path + '[' + i + ']', i);\n          }\n      } else {\n\n        // If it is an object, replicate the object.\n\n        nu = {};\n        for (name in value) {\n          if (Object.prototype.hasOwnProperty.call(value, name)) {\n            var nextPath = /^\\w+$/.test(name) ?\n              '.' + name :\n              '[' + JSON.stringify(name) + ']';\n            nu[name] = name === '$jsan' ? [derez(value[name], path + nextPath)] : derez(value[name], path + nextPath, name);\n          }\n        }\n      }\n      return nu;\n    }\n    return value;\n  }(object, '$'));\n};\n\n\nexports.retrocycle = function retrocycle($) {\n  'use strict';\n\n\n  return (function rez(value) {\n\n    // The rez function walks recursively through the object looking for $jsan\n    // properties. When it finds one that has a value that is a path, then it\n    // replaces the $jsan object with a reference to the value that is found by\n    // the path.\n\n    var i, item, name, path;\n\n    if (value && typeof value === 'object') {\n      if (Object.prototype.toString.apply(value) === '[object Array]') {\n        for (i = 0; i < value.length; i += 1) {\n          item = value[i];\n          if (item && typeof item === 'object') {\n            if (item.$jsan) {\n              value[i] = utils.restore(item.$jsan, $);\n            } else {\n              rez(item);\n            }\n          }\n        }\n      } else {\n        for (name in value) {\n          // base case passed raw object\n          if(typeof value[name] === 'string' && name === '$jsan'){\n            return utils.restore(value.$jsan, $);\n            break;\n          }\n          else {\n            if (name === '$jsan') {\n              value[name] = value[name][0];\n            }\n            if (typeof value[name] === 'object') {\n              item = value[name];\n              if (item && typeof item === 'object') {\n                if (item.$jsan) {\n                  value[name] = utils.restore(item.$jsan, $);\n                } else {\n                  rez(item);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    return value;\n  }($));\n};\n"]}]